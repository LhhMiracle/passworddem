<!-- 添加/编辑密码页面 -->
<view class="add-container">
  <scroll-view class="form-scroll" scroll-y="{{true}}">
    <!-- 分类选择 -->
    <view class="form-section">
      <view class="section-title">选择分类</view>
      <scroll-view class="category-scroll" scroll-x="{{true}}">
        <view class="category-list">
          <view
            class="category-chip {{formData.category === item.id ? 'active' : ''}}"
            wx:for="{{categories}}"
            wx:key="id"
            bindtap="selectCategory"
            data-category="{{item.id}}"
            style="border-color: {{item.color}}; {{formData.category === item.id ? 'background-color:' + item.color + ';color:#fff;' : 'color:' + item.color + ';'}}"
          >
            {{item.name}}
          </view>
        </view>
      </scroll-view>
    </view>

    <!-- 基本信息 -->
    <view class="form-section">
      <view class="section-title">基本信息</view>

      <view class="input-group">
        <view class="input-label">标题 *</view>
        <input
          class="input-field"
          placeholder="例如：微信账号"
          value="{{formData.title}}"
          bindinput="onInput"
          data-field="title"
        />
      </view>

      <view class="input-group">
        <view class="input-label">用户名/邮箱 *</view>
        <input
          class="input-field"
          placeholder="请输入用户名或邮箱"
          value="{{formData.username}}"
          bindinput="onInput"
          data-field="username"
        />
      </view>

      <view class="input-group">
        <view class="input-label">密码 *</view>
        <view class="password-input-wrapper">
          <input
            class="input-field"
            type="{{showPassword ? 'text' : 'password'}}"
            placeholder="请输入密码"
            value="{{formData.password}}"
            bindinput="onPasswordInput"
          />
          <view class="input-actions">
            <view class="action-icon" bindtap="togglePassword">
              <text>{{showPassword ? '&#128065;' : '&#128064;'}}</text>
            </view>
            <view class="action-icon" bindtap="generatePassword">
              <text>&#128736;</text>
            </view>
          </view>
        </view>
        <!-- 密码强度 -->
        <view class="strength-container" wx:if="{{formData.password}}">
          <view class="strength-bar">
            <view
              class="strength-fill"
              style="width: {{passwordStrength * 25}}%; background-color: {{strengthColor}};"
            ></view>
          </view>
          <text class="strength-text" style="color: {{strengthColor}};">{{strengthLabel}}</text>
        </view>
      </view>
    </view>

    <!-- 附加信息 -->
    <view class="form-section">
      <view class="section-title">附加信息（可选）</view>

      <view class="input-group">
        <view class="input-label">网站地址</view>
        <input
          class="input-field"
          placeholder="例如：https://weixin.qq.com"
          value="{{formData.website}}"
          bindinput="onInput"
          data-field="website"
        />
      </view>

      <view class="input-group">
        <view class="input-label">备注</view>
        <textarea
          class="textarea-field"
          placeholder="添加备注信息..."
          value="{{formData.notes}}"
          bindinput="onInput"
          data-field="notes"
          maxlength="500"
        ></textarea>
      </view>
    </view>
  </scroll-view>

  <!-- 底部按钮 -->
  <view class="form-footer">
    <button class="btn-cancel" bindtap="cancel">取消</button>
    <button
      class="btn-save {{canSave ? '' : 'btn-disabled'}}"
      bindtap="save"
      disabled="{{!canSave}}"
    >
      {{isEdit ? '保存修改' : '添加密码'}}
    </button>
  </view>

  <!-- 密码生成器弹窗 -->
  <view class="generator-modal" wx:if="{{showGenerator}}">
    <view class="modal-mask" bindtap="closeGenerator"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">密码生成器</text>
        <text class="modal-close" bindtap="closeGenerator">&#10005;</text>
      </view>

      <view class="generated-password">
        <text>{{generatedPassword}}</text>
      </view>

      <view class="generator-options">
        <view class="option-row">
          <text>密码长度: {{generatorOptions.length}}</text>
          <slider
            class="length-slider"
            min="8"
            max="32"
            value="{{generatorOptions.length}}"
            bindchange="onLengthChange"
            activeColor="#0052CC"
          />
        </view>

        <view class="option-row">
          <text>大写字母 (A-Z)</text>
          <switch
            checked="{{generatorOptions.includeUppercase}}"
            bindchange="onOptionChange"
            data-option="includeUppercase"
            color="#0052CC"
          />
        </view>

        <view class="option-row">
          <text>小写字母 (a-z)</text>
          <switch
            checked="{{generatorOptions.includeLowercase}}"
            bindchange="onOptionChange"
            data-option="includeLowercase"
            color="#0052CC"
          />
        </view>

        <view class="option-row">
          <text>数字 (0-9)</text>
          <switch
            checked="{{generatorOptions.includeNumbers}}"
            bindchange="onOptionChange"
            data-option="includeNumbers"
            color="#0052CC"
          />
        </view>

        <view class="option-row">
          <text>特殊符号 (!@#$)</text>
          <switch
            checked="{{generatorOptions.includeSymbols}}"
            bindchange="onOptionChange"
            data-option="includeSymbols"
            color="#0052CC"
          />
        </view>
      </view>

      <view class="modal-footer">
        <button class="btn-regenerate" bindtap="regeneratePassword">
          &#128260; 重新生成
        </button>
        <button class="btn-use" bindtap="useGeneratedPassword">
          使用此密码
        </button>
      </view>
    </view>
  </view>
</view>
